<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>НДФЛ 2025 — прогрессивный помесячный калькулятор</title>
  <style>
    :root{
      --c13:#10b981; /* emerald */
      --c15:#f59e0b; /* amber */
      --c18:#ef4444; /* red */
      --bg:#f6f7fb;
      --card:#fff;
      --text:#1f2937;
      --muted:#6b7280;
      --accent:#4f46e5;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;}
    .wrap{max-width:1100px;margin:0 auto;padding:24px;}
    h1{font-size:28px;margin:0 0 8px;font-weight:800}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .grid{display:grid;gap:16px}
    @media (min-width: 900px){ .grid{grid-template-columns:1.2fr .8fr;} }
    .card{background:var(--card);border-radius:16px;box-shadow:0 8px 24px rgba(16,24,40,.06);padding:20px;}
    .row{display:flex;gap:12px;align-items:center;margin:10px 0}
    label{font-weight:600}
    input[type=number]{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;font-size:16px;outline:none}
    input[type=number]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,70,229,.15)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{cursor:pointer;border:0;border-radius:12px;padding:12px 16px;font-weight:700}
    .btn-primary{background:linear-gradient(135deg,var(--accent),#22c55e);color:#fff}
    .btn-ghost{background:#f3f4f6}
    .toggle{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--muted);margin:6px 0 12px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700;font-size:12px;border:1px solid #e0e7ff}
    table{width:100%;border-collapse:separate;border-spacing:0 8px;font-size:14px}
    thead th{color:#6b7280;text-transform:uppercase;font-size:12px;text-align:left;padding:6px 10px}
    tbody tr{background:#fff}
    tbody td{padding:10px 10px;border-top:1px solid #eef2f7;border-bottom:1px solid #eef2f7}
    tbody tr td:first-child{border-left:1px solid #eef2f7;border-top-left-radius:10px;border-bottom-left-radius:10px}
    tbody tr td:last-child{border-right:1px solid #eef2f7;border-top-right-radius:10px;border-bottom-right-radius:10px}
    .sum{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .chip{border-radius:12px;padding:12px;font-weight:800}
    .c13{background:#ecfdf5;color:#065f46}
    .c15{background:#fffbeb;color:#92400e}
    .c18{background:#fef2f2;color:#991b1b}
    .ctot{background:#eef2ff;color:#312e81}
    .flex{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    .hidden{display:none}
    .error{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:10px;border-radius:10px;margin-top:10px;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <div class="flex"><h1>НДФЛ 2025 — прогрессивный помесячный калькулятор</h1><span class="badge">13% · 15% · 18%</span></div>
      <p class="lead">Считаем НДФЛ по гибридной шкале с накоплением в течение года: до 2 400 000 ₽ — 13%, 2 400 000–5 000 000 ₽ — 15%, 5 000 000–20 000 000 ₽ — 18%. Применение ставок — <b>маржинально</b> (только к части, превысившей порог).</p>
    </header>

    <main class="grid">
      <section class="card">
        <h2 style="margin:0 0 12px">Ввод доходов</h2>
        <label class="toggle"><input id="modeToggle" type="checkbox"> Расширенный режим (ввод по каждому месяцу)</label>

        <div id="simpleMode">
          <div class="row"><label style="min-width:190px">Ежемесячный доход, ₽</label><input id="monthlyUniform" type="number" min="0" step="100" value="300000"></div>
        </div>

        <div id="advancedMode" class="hidden">
          <div class="row" style="flex-wrap:wrap">
            <!-- Month inputs inserted here -->
            <div id="monthInputs" style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;width:100%"></div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn-primary">Рассчитать</button>
          <button id="resetBtn" class="btn-ghost">Сброс</button>
        </div>
        <div id="err" class="error"></div>
        <div class="note">Подсказка: Измените доход и нажмите «Рассчитать». В расширенном режиме задайте суммы по каждому месяцу.</div>
      </section>

      <aside class="card">
        <h2 style="margin:0 0 12px">Сводка</h2>
        <div class="sum">
          <div class="chip c13"><div class="flex"><span>Налог 13%</span><span id="sum13">0</span></div></div>
          <div class="chip c15"><div class="flex"><span>Налог 15%</span><span id="sum15">0</span></div></div>
          <div class="chip c18"><div class="flex"><span>Налог 18%</span><span id="sum18">0</span></div></div>
          <div class="chip ctot"><div class="flex"><span>Итого НДФЛ</span><span id="sumTotal">0</span></div></div>
        </div>
        <div class="note">Если ваш доход превышает 20 000 000 ₽, верхняя ставка 18% применяется к сумме сверх 5 000 000 ₽ (уточните, если должен быть иной верхний порог).</div>
      </aside>
    </main>

    <section class="card" style="margin-top:16px">
      <div class="flex"><h2 style="margin:0">Помесячный расчёт</h2><div class="note">Ставки применяются к частям дохода в момент перехода порога.</div></div>
      <div style="overflow-x:auto;margin-top:8px">
        <table id="tbl">
          <thead>
            <tr>
              <th>Месяц</th>
              <th>Доход</th>
              <th>Накопленный</th>
              <th style="color:var(--c13)">Налог 13%</th>
              <th style="color:var(--c15)">Налог 15%</th>
              <th style="color:var(--c18)">Налог 18%</th>
              <th>Итого</th>
              <th>Чистыми</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
(function(){
  // --- Constants as per user's rules ---
  const threshold1 = 2400000;
  const threshold2 = 5000000;
  const threshold3 = 20000000; // верхний ориентир; ставка 18% остаётся верхней (можно менять при необходимости)
  const rate1 = 0.13, rate2 = 0.15, rate3 = 0.18;
  const months = ["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];

  // --- Elements ---
  const modeToggle = document.getElementById('modeToggle');
  const simpleMode = document.getElementById('simpleMode');
  const advancedMode = document.getElementById('advancedMode');
  const monthlyUniform = document.getElementById('monthlyUniform');
  const monthInputsWrap = document.getElementById('monthInputs');
  const calcBtn = document.getElementById('calcBtn');
  const resetBtn = document.getElementById('resetBtn');
  const tbody = document.getElementById('tbody');
  const err = document.getElementById('err');
  const sum13El = document.getElementById('sum13');
  const sum15El = document.getElementById('sum15');
  const sum18El = document.getElementById('sum18');
  const sumTotalEl = document.getElementById('sumTotal');

  // --- Helpers ---
  const fmt = n => (isFinite(n) ? n.toLocaleString('ru-RU', {maximumFractionDigits:2}) : '—');

  function buildAdvancedInputs(){
    monthInputsWrap.innerHTML = "";
    months.forEach((m, i) => {
      const div = document.createElement('div');
      const label = document.createElement('label');
      label.textContent = m;
      label.style.fontSize = '12px';
      label.style.color = '#6b7280';
      const input = document.createElement('input');
      input.type = 'number'; input.min = '0'; input.step = '100';
      input.value = 300000;
      input.style.padding = '10px'; input.style.border = '1px solid #e5e7eb';
      input.style.borderRadius = '12px'; input.style.outline = 'none';
      input.addEventListener('focus', () => input.style.boxShadow = '0 0 0 3px rgba(79,70,229,.15)');
      input.addEventListener('blur',  () => input.style.boxShadow = 'none');
      div.appendChild(label); div.appendChild(input);
      monthInputsWrap.appendChild(div);
    });
  }

  function getIncomes(){
    if (!modeToggle.checked){
      const v = Number(monthlyUniform.value || 0);
      return Array(12).fill(v);
    }
    // get from monthInputsWrap children
    const arr = [];
    monthInputsWrap.querySelectorAll('input').forEach(inp => {
      const v = Number(inp.value || 0);
      arr.push(v);
    });
    // if not built yet, default all zeros
    return arr.length ? arr : Array(12).fill(0);
  }

  // --- Core progressive tax per-month with cumulative thresholds ---
  function computeRows(incomes){
    let rows = [];
    let accum = 0, sum13 = 0, sum15 = 0, sum18 = 0;

    for (let i=0;i<12;i++){
      const income = Number(incomes[i]||0);
      const prev = accum;
      accum += income;

      let t13=0, t15=0, t18=0;

      // 13%: applies to portion up to threshold1
      if (prev < threshold1){
        t13 = Math.max(0, Math.min(accum, threshold1) - prev) * rate1;
      }

      // 15%: applies to portion between threshold1 and threshold2
      if (accum > threshold1){
        const lower = Math.max(prev, threshold1);
        const upper = Math.min(accum, threshold2);
        if (upper > lower) t15 = (upper - lower) * rate2;
      }

      // 18%: applies to portion above threshold2 (до/свыше 20 млн по вашей конфигурации)
      if (accum > threshold2){
        const lower = Math.max(prev, threshold2);
        const upper = accum; // верхняя граница threshold3 не ограничивает ставку (ставка та же)
        if (upper > lower) t18 = (upper - lower) * rate3;
      }

      const total = t13 + t15 + t18;
      const net = income - total;

      rows.push({
        m: months[i],
        income, accum, t13, t15, t18, total, net
      });

      sum13 += t13; sum15 += t15; sum18 += t18;
    }
    return {rows, sum13, sum15, sum18};
  }

  function render({rows, sum13, sum15, sum18}){
    // totals
    sum13El.textContent = fmt(sum13);
    sum15El.textContent = fmt(sum15);
    sum18El.textContent = fmt(sum18);
    sumTotalEl.textContent = fmt(sum13 + sum15 + sum18);

    // table
    tbody.innerHTML = "";
    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="font-weight:700">${r.m}</td>
        <td>${fmt(r.income)}</td>
        <td>${fmt(r.accum)}</td>
        <td style="color:var(--c13)">${fmt(r.t13)}</td>
        <td style="color:var(--c15)">${fmt(r.t15)}</td>
        <td style="color:var(--c18)">${fmt(r.t18)}</td>
        <td style="font-weight:700">${fmt(r.total)}</td>
        <td>${fmt(r.net)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function runCalc(){
    try{
      err.style.display='none'; err.textContent='';
      const incomes = getIncomes();
      const result = computeRows(incomes);
      render(result);
    }catch(e){
      err.style.display='block';
      err.textContent = 'Ошибка расчёта: ' + (e && e.message ? e.message : e);
    }
  }

  function resetAll(){
    monthlyUniform.value = 300000;
    if (modeToggle.checked){
      monthInputsWrap.querySelectorAll('input').forEach(inp => inp.value = 300000);
    }
    runCalc();
  }

  // --- Events ---
  modeToggle.addEventListener('change', () => {
    const adv = modeToggle.checked;
    advancedMode.classList.toggle('hidden', !adv);
    simpleMode.classList.toggle('hidden', adv);
    if (adv && monthInputsWrap.children.length === 0) buildAdvancedInputs();
  });

  calcBtn.addEventListener('click', runCalc);
  resetBtn.addEventListener('click', resetAll);
  monthlyUniform.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ runCalc(); }});
  // build inputs and first render
  buildAdvancedInputs();
  runCalc();
})();
</script>
</body>
</html>
